{"version":3,"sources":["../../src/functions/common.ts"],"sourcesContent":["import \"@moonbeam-network/api-augment\";\nimport { BN } from \"@polkadot/util\";\n\n// Sort dict by key\nexport function sortObjectByKeys(obj: Record<string, any>): Record<string, any> {\n  const sortedKeys = Object.keys(obj).sort();\n  const sortedObj: Record<string, any> = {};\n\n  for (const key of sortedKeys) {\n    sortedObj[key] = obj[key];\n  }\n\n  return sortedObj;\n}\n\n// Perthings arithmetic conformant type.\nclass Perthing {\n  private unit: BN;\n  private perthing: BN;\n\n  constructor(unit: BN, num: BN | number, denom?: BN | number) {\n    let numerator = num;\n    let denominator = denom;\n\n    if (!(numerator instanceof BN)) {\n      numerator = new BN(numerator.toString());\n    }\n    if (denominator && !(denominator instanceof BN)) {\n      denominator = new BN(denominator.toString());\n    }\n\n    this.unit = unit;\n    if (denominator) {\n      this.perthing = numerator.mul(unit).div(denominator as BN);\n    } else {\n      this.perthing = numerator;\n    }\n  }\n\n  value(): BN {\n    return this.perthing;\n  }\n\n  of(value: BN): BN {\n    return this.divNearest(this.perthing.mul(value), this.unit);\n  }\n\n  ofCeil(value: BN): BN {\n    return this.divCeil(this.perthing.mul(value), this.unit);\n  }\n\n  toString(): string {\n    return `${this.perthing.toString()}`;\n  }\n\n  divCeil(a: any, num: BN) {\n    const dm = a.divmod(num);\n\n    // Fast case - exact division\n    if (dm.mod.isZero()) return dm.div;\n\n    // Round up\n    return dm.div.negative !== 0 ? dm.div.isubn(1) : dm.div.iaddn(1);\n  }\n\n  divNearest(a: any, num: BN) {\n    const dm = a.divmod(num);\n\n    // Fast case - exact division\n    if (dm.mod.isZero()) return dm.div;\n\n    const mod = dm.div.negative !== 0 ? dm.mod.isub(num) : dm.mod;\n\n    const half = num.ushrn(1);\n    const r2 = num.andln(1);\n    const cmp = mod.cmp(half);\n\n    // Round down\n    if (cmp <= 0 || (r2 === new BN(1) && cmp === 0)) return dm.div;\n\n    // Round up\n    return dm.div.negative !== 0 ? dm.div.isubn(1) : dm.div.iaddn(1);\n  }\n}\n\n// Perthings arithmetic conformant type representing part(s) per billion.\nexport class Perbill extends Perthing {\n  constructor(numerator: BN | number, denominator?: BN | number) {\n    super(new BN(1_000_000_000), numerator, denominator);\n  }\n}\n\n// Perthings arithmetic conformant type representing part(s) per cent.\nexport class Percent extends Perthing {\n  constructor(numerator: BN | number, denominator?: BN | number) {\n    super(new BN(100), numerator, denominator);\n  }\n}\n\nexport function getObjectMethods(obj: any): string[] {\n  const properties = new Set<string>();\n  let currentObj: any = obj;\n\n  while (currentObj) {\n    for (const item of Object.getOwnPropertyNames(currentObj)) {\n      properties.add(item);\n    }\n    currentObj = Object.getPrototypeOf(currentObj);\n  }\n\n  return Array.from(properties).filter((item) => typeof obj[item] === \"function\");\n}\n\nexport async function directRpcRequest(\n  endpoint: string,\n  method: string,\n  params: any[] = [],\n  timeoutMs: number = 10000 // Default 10 second timeout\n): Promise<any> {\n  const data = {\n    jsonrpc: \"2.0\",\n    id: 1,\n    method,\n    params,\n  };\n\n  if (endpoint.startsWith(\"ws\")) {\n    console.log(\"you've passed a websocket to fetch, is this intended?\");\n  }\n\n  // Create an AbortController for timeout\n  const controller = new AbortController();\n  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\n\n  try {\n    const response = await fetch(endpoint, {\n      method: \"POST\",\n      body: JSON.stringify(data),\n      headers: { \"Content-Type\": \"application/json\" },\n      signal: controller.signal,\n    });\n\n    clearTimeout(timeoutId);\n\n    const responseData = (await response.json()) as JsonRpcResponse;\n\n    if (responseData.error) {\n      throw new Error(responseData.error.message);\n    }\n\n    return responseData.result;\n  } catch (error: any) {\n    clearTimeout(timeoutId);\n    if (error.name === \"AbortError\") {\n      throw new Error(\n        `RPC request to ${endpoint} timed out after ${timeoutMs}ms (method: ${method})`\n      );\n    }\n    throw error;\n  }\n}\n\ninterface JsonRpcResponse {\n  result?: any;\n  error?: {\n    code: number;\n    message: string;\n  };\n}\n"],"mappings":"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","names":[]}